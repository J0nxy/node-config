<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.4">
<title>Node-Config Documentation</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="book toc2 toc-right">
<div id="header">
<h1>Node-Config Documentation</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#_introduction_quick_start">Introduction &amp; Quick-start</a>
<ul class="sectlevel1">
<li><a href="#_what_node_config_is">1. What node-config is</a></li>
<li><a href="#_quick_start">2. Quick-start</a></li>
<li><a href="#_using_packages">3. Using packages</a></li>
<li><a href="#_internet_sharing">4. Internet Sharing</a>
<ul class="sectlevel2">
<li><a href="#_direct_exit">4.1. Direct Exit</a></li>
<li><a href="#_using_a_vpn_provider">4.2. Using a VPN provider</a></li>
</ul>
</li>
<li><a href="#_git_directory_structure">5. Git directory structure</a></li>
</ul>
</li>
<li><a href="#_configuration_in_node_config">Configuration in node-config</a>
<ul class="sectlevel1">
<li><a href="#__etc_config_wireless">6. /etc/config/wireless</a>
<ul class="sectlevel2">
<li><a href="#_naming_the_service_set_id_ssid">6.1. Naming the Service Set ID (SSID):</a></li>
<li><a href="#_using_ieee_802_11s">6.2. Using IEEE 802.11s</a></li>
</ul>
</li>
<li><a href="#__etc_config_batman_adv">7. /etc/config/batman-adv</a></li>
<li><a href="#__etc_config_network">8. /etc/config/network</a>
<ul class="sectlevel2">
<li><a href="#_network_interfaces">8.1. Network Interfaces</a></li>
<li><a href="#_routes_rules">8.2. Routes &amp; Rules</a></li>
<li><a href="#_pptp_configuration">8.3. PPtP configuration</a></li>
</ul>
</li>
<li><a href="#__etc_config_babeld">9. /etc/config/babeld</a></li>
<li><a href="#__etc_config_dhcp">10. /etc/config/dhcp</a></li>
<li><a href="#__etc_config_fastd">11. /etc/config/fastd</a></li>
<li><a href="#__etc_config_firewall_firewall_user">12. /etc/config/firewall &amp; firewall.user</a></li>
<li><a href="#__etc_config_openvpn">13. /etc/config/openvpn</a></li>
</ul>
</li>
<li><a href="#_advanced_topics">Advanced Topics</a>
<ul class="sectlevel1">
<li><a href="#_building_node_config">14. Building node-config</a>
<ul class="sectlevel2">
<li><a href="#_makefiles">14.1. Makefiles</a></li>
<li><a href="#__travis_ci_yml">14.2. .travis-ci.yml</a></li>
<li><a href="#_install_sh">14.3. install.sh</a></li>
</ul>
</li>
<li><a href="#_creating_firmware_configuration_management">15. Creating Firmware &amp; Configuration Management</a></li>
<li><a href="#_underlaying_concepts">16. Underlaying concepts</a>
<ul class="sectlevel2">
<li><a href="#_roaming">16.1. Roaming</a></li>
<li><a href="#_ipv6_multihoming_prefix_delegation">16.2. IPv6 Multihoming &amp; Prefix delegation</a></li>
<li><a href="#_icvpn_routing">16.3. ICVPN routing</a></li>
</ul>
</li>
<li><a href="#_design_considerations">17. Design considerations</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<h1 id="_introduction_quick_start" class="sect0">Introduction &amp; Quick-start</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>Most of us are into free wireless mesh networks. We&#8217;re fascinated by the idea of
deploying a bunch of OpenWRT routers, that magically connect to each other
to span large mesh cloud.</p>
</div>
<div class="paragraph">
<p>Unfortunately, doing so is very hard - the various different options for mesh routing protocols
and network designs can be overwhelming.</p>
</div>
<div class="paragraph">
<p>Many community networks deploy complex configurations. They release
custom firmware blobs using self-written scripts to customize OpenWRT images.
Usually, these firmware blobs are tight to a specific network by including network addresses or wifi identifiers.</p>
</div>
<div class="paragraph">
<p>Some Freifunk firmware files even include vpn-server-addresses, rendering them useless for other communities or
people living just a few kilometers away.</p>
</div>
<div class="paragraph">
<p>Here, configuration becomes opaque and thus hard to understand: It&#8217;s buried in binary images using custom
software and different, sometimes hackish startup-scripts.</p>
</div>
<div class="paragraph">
<p>Build systems such as Gluon provide a heavy-weight abstraction to OpenWRT.
By creating a Domain-Specific-Language (DSL), all relevant OpenWRT settings are duplicated into a site-model,
which is then used to describe a specific community network. Although not having explicit restrictions,
this site-model focuses on backend-server driven networks, somewhat missing the point of a wifi mesh network.
Very little changes to the configuration require a build using the full OpenWRT buildroot.</p>
</div>
<div class="paragraph">
<p>Node-config is trying to jump in here by providing a comprehensible configuration.
Without having a shiny user interface in its core, node-config is focusing on network enthusiasts.
It explains all necessary OpenWRT settings for a simple wifi mesh, while providing complete and easy-to-use setup.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_what_node_config_is">1. What node-config is</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Node-config is just a <em>bunch of uci configuration files including a scripts to apply them</em>. It is copied to
plain OpenWRT routers running Lede 17.01 and merged into the existing configuration. It configures routing, network- and wireless interfaces as
well as network services such as dhcp and radv.</p>
</div>
<div class="paragraph">
<p>It spans a mesh network using <em>both babel and batman-adv</em> to provide roaming and
hierarchical routing capabilities. The network is IPv4 and IPv6 dual-stack.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="ulist">
<div class="title">You can use and understand node-config as:</div>
<ul>
<li>
<p>An elaborate example for an OpenWRT mesh configuration</p>
</li>
<li>
<p>A kickstarter or template for wifi mesh networks without a central vpn (i.e. servers)</p>
</li>
<li>
<p>A way for building supernodish nodes in gluon based Freifunk networks to get rid of servers</p>
</li>
<li>
<p>A lean baseline for testing new architectures and services (i.e. l3roamd)</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A git-repository is availble at  <a href="https://github.com/node-config" class="bare">https://github.com/node-config</a> -
for help and discussions please subscribe to the
<a href="https://lists.freifunk.net/mailman/listinfo/wlanware-freifunk.net">wlanware mailing list</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_quick_start">2. Quick-start</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You need <a href="https://downloads.openwrt.org">OpenWRT / LEDE 17.01</a> installed on a router and enough free flash space (~2 MB).
The router has to be connected to the internet (wan port) an to your computer (pc or laptop using the lan port)</p>
</div>
<div class="paragraph">
<p>It helps to be familiar with a unix terminal (i.e. Mac OS, Linux)
since you need to use ssh to connect to your router. In addition, git is required:</p>
</div>
<div class="listingblock">
<div class="title">On your computer execute:</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">git clone https://github.com/yanosz/node-config.git
cd node-config; scp -r freifunk root@192.168.1.1:/lib
ssh root@192.168.1.1 /lib/freifunk/install.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is assumed, that your router is reachable at <code>192.168.1.1</code> (OpenWRT default). Using <code>git</code>, <code>scp</code> and <code>ssh</code>
node-config is cloned and then copied to your router. It is applied using <a href="#_install_sh">install.sh</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>Set a password</em> - your router will be reachble using ssh.</p>
</li>
<li>
<p>When executing <code>/lib/freifunk/install.sh</code> you are asked for one IPv4 (/24) and one IPv6 (/64) network.
These networks are distributed using dhcp and radv and <em>have to be unique</em>.
You <em>must not share a subnet among routers</em>. Using distinct RFC1918 ranges and IPv6 unique local addresses (ULA)
is usually the way to go. Please mind bookkeeping.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_packages">3. Using packages</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Package can be used <em>instead of copying the filesystem tree</em> using git and scp.</p>
</div>
<div class="paragraph">
<p>For testing, opkg packages are available at: <a href="https://kbu.freifunk.net/files/node-config/" class="bare">https://kbu.freifunk.net/files/node-config/</a>. Packages are built
using the projects <a href="#_makefiles">Makefiles</a> and Gitlab CI server.</p>
</div>
<div class="listingblock">
<div class="title">To install the packages open a ssh session to your router and execute:</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">wget -O /etc/opkg/keys/cca6643a8ac2f277 http://opkg.kbu.freifunk.net/node-config/cca6643a8ac2f277
echo &quot;src/gz nc http://opkg.kbu.freifunk.net/node-config/packages&quot; &gt;&gt; /etc/opkg/customfeeds.conf
opkg update
opkg install node-config node-config-openvpn node-config-pptp</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>Reboot the router</em>, after installing the packages.
For setting IPv4 and IPv6 networks open a new ssh session execute <code>/lib/freifunk/set_ip.sh</code>.
When executing <code>opkg install node-config</code>, core components are installed, only - openvpn and pptp are not available.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set a password - your router will be reachable using ssh</p>
</li>
<li>
<p>Make sure, that <code>/etc/opkg/keys/cca6643a8ac2f277</code> matches the key available at
<a href="https://kbu.freifunk.net/files/node-config/cca6643a8ac2f277" class="bare">https://kbu.freifunk.net/files/node-config/cca6643a8ac2f277</a> - the download <em>is not using TLS</em>.</p>
</li>
<li>
<p>The public key for <code>cca6643a8ac2f277</code> is availble in our Gitlab CI and may be easily become compromised.
Consider using you own key when using packages. For details see <a href="#_makefiles">Makefiles</a>.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_internet_sharing">4. Internet Sharing</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_direct_exit">4.1. Direct Exit</h3>
<div class="paragraph">
<p>To share the routers WAN uplink in the mesh cloud, you have to enable it.</p>
</div>
<div class="listingblock">
<div class="title">Open a ssh session to your router and execute:</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">uci set network.internet_share.disabled=0
uci set network.internet_share6.disabled=0
uci firewall.freifunk_internet.dest='wan'
uci commit firewall
uci commet network
/etc/init.d/firewall restart
/etc/init.d/network restart</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
By enabling <code>internet_share</code> and <code>internet_share6</code>, WAN routes will be copied to the
mesh routing table. <code>uci firewall.freifunk_internet.dest='wan'</code> enables forwarding.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_using_a_vpn_provider">4.2. Using a VPN provider</h3>
<div class="paragraph">
<p>To use a vpn tunnel (i.e. mullvad),
you can use a configuration in <code>/lib/freifunk/vpn</code> and activate it by editing <code>/etc/config/openvpn</code>.
See <a href="#__etc_config_openvpn">/etc/config/openvpn</a> for details.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
If you want to use a provider not included in
<code>/lib/freifunk/vpn</code>, you can place your provider&#8217;s configuration there.
Mind adding <code>route-nopull</code>, <code>script-security 2</code> and <code>up /lib/freifunk/vpn/up.sh</code> for default route handling.
Have a look at existing VPN configurations for example. Also mind setting <code>dev vpn-nat</code> to use
the correct network interface.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_git_directory_structure">5. Git directory structure</h2>
<div class="sectionbody">
<div class="paragraph">
<p>All configuration can be found in <code>/freifunk/initial_configuration</code>. Other directories contain scripts,
build files and documentation.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contents</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Directory root, including readme&#8217;s, the project&#8217;s Makefile and CI-configuration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/doc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Documentation including the asciidoc source of this manual</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/freifunk</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration including scripts</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/freifunk/initial_configuration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OpenWRT configuration (uci)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/freifunk/lib</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shared routines for scripts</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/freifunk/vpn</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OpenVPN exit configuration for different providers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/lede_built/node-config</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Makefiles and other files for creating OpenWRT packages</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<h1 id="_configuration_in_node_config" class="sect0">Configuration in node-config</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>The configuration is documented on a per-file basis - Each OpenWRT configuration is explained individually.</p>
</div>
<div class="paragraph">
<p>Figure 1 shows the system from a birds eye perspective.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="interface-configuration.png" alt="interface configuration">
</div>
<div class="title">Figure 1. Interface configuration - bird&#8217;s eye perspective</div>
</div>
<div class="paragraph">
<p>Node-config creates a hand full of interfaces: wlan0, wlan1, bat0, br-freifunk
as well as vpn interfaces like tap0 and ppp0. They are configured as follows:</p>
</div>
<div class="ulist">
<div class="title">External interfaces (switch ports, radio)</div>
<ul>
<li>
<p><em>wlan0</em> and <em>wlan1</em> are set up by node-config</p>
<div class="ulist">
<ul>
<li>
<p>wlan0 is running in master mode. It&#8217;s used by all clients.</p>
</li>
<li>
<p>wlan1 is running in ad-hoc (or 802.11s) mode. This interface is used for meshing.</p>
</li>
</ul>
</div>
</li>
<li>
<p><em>ethX (WAN)</em> and <em>ethY (LAN)</em> are created by OpenWRT. They are not configured by node-config.</p>
<div class="ulist">
<ul>
<li>
<p>The LAN interface is used for a management (SSH / LuCI).</p>
</li>
<li>
<p>The WAN interface connects to the internet. It can be used for internet sharing.</p>
</li>
<li>
<p>Optionally, a VPN (openvpn, pptp, wiregard) can tunnel internet traffic.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Internal interfaces (bridges, vpn)</div>
<ul>
<li>
<p><em>bat0</em> is the batman-adv interface of the system. It utilizes the ad-hoc interface for meshing.</p>
</li>
<li>
<p><em>br-freifunk</em> is central: It bridges all clients (wlan0) into the roaming domain (wlan1).</p>
</li>
<li>
<p>Other vpn interfaces (<em>fastd: tap0, l2tp: l2tpeth0</em>) are optional: They created and
assigned to batman-adv and / or babel to mesh and roam using wires or directed wireless links.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Some interfaces are used by services to provide connectivity:</p>
</div>
<div class="ulist">
<div class="title">Miscellous interfaces (not shown)</div>
<ul>
<li>
<p><em>DHCP</em> and <em>radv</em> services are running on br-freifunk. They hand out ip-addresses to clients.
However, these dropped on bat0 using ebtables to reduce broadcast / multicast traffic.</p>
</li>
<li>
<p><em>babel</em> is running on the wlan1 interface and all vpn interfaces used for mesh routing.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Mind not to bind the optional vpn interfaces to br-freifunk / bat0.
It is easy to have a catch-22.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Some interfaces are missing in the picture - have a look at the actual system:</p>
</div>
<div class="ulist">
<div class="title">Additional interfaces</div>
<ul>
<li>
<p>Most interfaces have an IPv6 counterpart. These duplicates are needed by OpenWRT</p>
</li>
<li>
<p><code>internet_share</code> is a duplicate of the  WAN interfaces.
It&#8217;s used for copying WAN routes into the freifunk routing tables.</p>
</li>
<li>
<p>By default, node-config creates two optional interfaces using fastd. One is for
Routing within Freifunk communities (<em>enabled</em>), while the other is part of the
Freifunk / Gluon supernode template (<em>disabled</em>)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__etc_config_wireless">6. /etc/config/wireless</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The wireless configuration is generated using a shell script
Additional information in wireless
configuration can be found in the OpenWRT wiki. the <a href="https://openwrt.org/docs/guide-user/network/wifi/basic">OpenWRT wiki</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
The regulatory region is set to <code>DE</code> (Germany).
Please adjust if needed
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Content of <code>wireless.sh</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">#!/bin/sh
if [ -z $(uci get wireless.radio0) ]; then
        echo &quot;No wifi device found&quot;
fi

radio0_disabled=$(uci get wireless.radio0.disabled)
radio0_default=$(uci get wireless.default_radio0)

if [ &quot;$radio0_disabled&quot; == &quot;1&quot; ] &amp;&amp; [ &quot;$radio0_default&quot; == &quot;wifi-iface&quot; ];then
        echo &quot;Disabled adapter with default configuration found - disabling default configuration&quot;
        uci set wireless.default_radio0.disabled='1'
fi

echo &quot;Creating wifi interface on radio0 - Assuming 2.4 Ghz - Using channel 1&quot;
uci -q batch &lt;&lt;EOF
        set wireless.radio0.disabled='0'
        set wireless.radio0.channel='1'                 # Radio settings
        set wireless.radio0.htmode='HT20'
        set wireless.radio0.country='DE'
        set wireless.wifi_freifunk='wifi-iface'         # 1. wifi: Accesspoint
        set wireless.wifi_freifunk.device='radio0'
        set wireless.wifi_freifunk.network='freifunk'
        set wireless.wifi_freifunk.mode='ap'
        set wireless.wifi_freifunk.ssid='Freifunk'

        set wireless.wifi_mesh='wifi-iface'             # 2. wifi: ad-Hoc mesh
        set wireless.wifi_mesh.device='radio0'
        set wireless.wifi_mesh.network='mesh babel_mesh'
        set wireless.wifi_mesh.mode='adhoc'
        set wireless.wifi_mesh.ssid='42:42:42:42:42:42'
        set wireless.wifi_mesh.bssid='42:42:42:42:42:42'
        set wireless.wifi_mesh.mcast_rate='12000'
EOF



radio1=$(uci get wireless.radio1)
if [ $radio1 ];then
        echo &quot;Found 2nd wifi-interface - Assuming 5Ghz - Using channel 36&quot;
        radio1_disabled=$(uci get wireless.radio1.disabled)
        radio1_default=$(uci get wireless.default_radio1)

        if [ &quot;$radio1_disabled&quot; == &quot;1&quot; ] &amp;&amp; [ &quot;$radio1_default&quot; == &quot;wifi-iface&quot; ];then
                echo &quot;Disabled adapter with default configuration found - disabling default configuration&quot;
                uci set wireless.default_radio1.disabled='1'
        fi
        uci -q batch &lt;&lt;EOB
                set wireless.radio1.disabled='0'
                set wireless.radio1.channel='36'                 # radio settings
                set wireless.radio1.country='DE'
                set wireless.radio1.htmode='HT40'
                set wireless.wifi_freifunk5='wifi-iface'         # 1. wifi: accesspoint
                set wireless.wifi_freifunk5.device='radio1'
                set wireless.wifi_freifunk5.network='freifunk'
                set wireless.wifi_freifunk5.mode='ap'
                set wireless.wifi_freifunk5.ssid='Freifunk'

                set wireless.wifi_mesh5='wifi-iface'             # 2. wifi: ad-Hoc mesh
                set wireless.wifi_mesh5.device='radio1'
                set wireless.wifi_mesh5.network='mesh5 babel_mesh5'
                set wireless.wifi_mesh5.mode='adhoc'
                set wireless.wifi_mesh5.ssid='42:42:42:42:42:42'
                set wireless.wifi_mesh5.bssid='42:42:42:42:42:42'
                set wireless.wifi_mesh5.mcast_rate='12000'

EOB

fi

uci commit wireless</code></pre>
</div>
</div>
<div class="olist arabic">
<div class="title">Three things are done by <code>wireless.sh</code>:</div>
<ol class="arabic">
<li>
<p>It detects how many radios are available</p>
<div class="ulist">
<ul>
<li>
<p>If there&#8217;s a radio, 2.4 Ghz is assumed. It&#8217;s locked to channel 1 and enabled</p>
</li>
<li>
<p>If there&#8217;s a second radio, 5 Ghz is assumed. It&#8217;s locked to channel 36 and enabled.</p>
</li>
<li>
<p>Other radios are ignored</p>
</li>
</ul>
</div>
</li>
<li>
<p>If unused OpenWRT default configurations are present on a radio, they are disabled.</p>
</li>
<li>
<p>An ad-hoc interface with SSID <code>42:42:42:42:42:42</code> and an access point interface with SSID <code>Freifunk</code>
is created on all radios detected before. All ad-hoc interfaces use a broadcast rate of 12 MBit/s. While the 5 Ghz radio is using 40 Mhz,
the 2.4 GHz has 20 MHz.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="_naming_the_service_set_id_ssid">6.1. Naming the Service Set ID (SSID):</h3>
<div class="paragraph">
<p>You can adjust the BSSID and SSID according to your needs. Creating separated networks
requires using different SSIDs. For roaming, all SSID of a network must be the same:</p>
</div>
<div class="paragraph">
<p>On the one hand, moving to an accesspoint with a different SSID will reinitialize the wifi card -
all active connections will be lost. On the other hand, all mesh stations need the same SSID to connect to each other. The network
will fall apart, if they differ.</p>
</div>
<div class="paragraph">
<p>Keep in mind, that the <em>Extended Service Set ID</em> (ESSID) is called <em>SSID</em> in OpenWRT.
It is the network name shown on clients. The <em>Basic Service Set ID (BSSID)</em> defines the technical identifier
of the ad-hoc segment. By its design, ad-hoc networks can fall apart by mistakenly generating different BSSIDs
for the same logical segment. Thus the BSSID needs set to fixed value. The issue is addressed by IEEE 802.11s.</p>
</div>
<div class="paragraph">
<p>For more details on service sets have a look at
<a href="https://en.wikipedia.org/wiki/Service_set_(802.11_network)">wikipedia</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_using_ieee_802_11s">6.2. Using IEEE 802.11s</h3>
<div class="paragraph">
<p>You can use the new IEEE 802.11s mesh mode instead of the new ad-hoc. To do so, you need to modify
<code>wireless.sh</code>.</p>
</div>
<div class="listingblock">
<div class="title">Modication to <code>wireless.sh</code> - example for radio0 (first radio, 2.4 Ghz usually).</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"># ...
        set wireless.wifi_mesh='wifi-iface'
        set wireless.wifi_mesh.device='radio0'
        set wireless.wifi_mesh.network='mesh babel_mesh'
        set wireless.wifi_mesh.mode='mesh'
        set wireless.wifi_mesh.mesh_id='42:42:42:42:42:42'
        set wireless.wifi_mesh_fwding='0'
        set wireless.wifi_mesh.mcast_rate='12000'
# ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>When modifying the 5 Ghz network, use <code>wifi_mesh5</code> instead of <code>wifi_mesh</code>.</p>
</div>
<div class="paragraph">
<p>Setting <code>mesh_fwding='0'</code> disables forwarding in the IEEE 802.11s mesh network.
Forwarding <em>is disabled</em>, because  Babel and batman-adv need to see the topology on their own.
Forwarding would hide the structure of network from both babel and batman-adv.
In addition, it is redundant to batman-adv.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="olist arabic">
<div class="title">If experimenting with IEEE 802.11s mesh forwarding:</div>
<ol class="arabic">
<li>
<p>Disable batman-adv - directly attach the mesh interfaces to the Freifunk bridge</p>
</li>
<li>
<p>Try to make babeld using the overlay metric</p>
</li>
<li>
<p>Avoid re-transmitting babel messages - IEEE 802.11s will distribute them anyway.</p>
</li>
<li>
<p>Happy hacking :-).</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__etc_config_batman_adv">7. /etc/config/batman-adv</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://www.open-mesh.org/projects/batman-adv/wiki">Batman-adv</a> is used for roaming.
It uses all wifi ad-hoc interface (2.4 Ghz and 5 Ghz). In addition, VPN (l2tp, fastd)
interfaces can be added to improving roaming when no radio contact is available.</p>
</div>
<div class="paragraph">
<p>The configuration does not contain any network interfaces. The mapping is done in
<code>/etc/config/network</code>. More details configuration options are listed in the
<a href="https://www.open-mesh.org/projects/batman-adv/wiki/Batman-adv-openwrt-config">Open-Mesh wiki</a>.</p>
</div>
<div class="listingblock">
<div class="title"><code>batman-adv.uci</code> creates a mesh (<code>bat0</code>) using these options.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">package batman-adv

# Batman-adv is used for roaming
# Every node is a batman-adv gateway, since it runs a dhcp service
# DAT, aggregated_ogms and bridge_loop_avoidance are enabled.
config mesh 'bat0'
        option orig_interval '5000'
        option bridge_loop_avoidance '1'
        option gw_mode 'server'
        option fragmentation '1'
        option aggregated_ogms '1'
        option distributed_arp_table '1'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Having hardly any mobility in a Freifunk-style network, an originator interval of 5 seconds
is enough. Bridge loop avoidance, the distributed arp table
and ogm aggregation is enabled.</p>
</div>
<div class="paragraph">
<p>Fragmentation is enabled for roaming using wired interfaces. Usually, ethernet, l2tp or fastd
connections cannot transmit a complete batman-adv frame
using up to 1532 bytes without fragmentation.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__etc_config_network">8. /etc/config/network</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The network configuration is probably the most complex part of node-config.
Be brave, you&#8217;ll make it :-).</p>
</div>
<div class="paragraph">
<p>Have a look at the <a href="https://openwrt.org/docs/guide-user/base-system/basic-networking" class="bare">https://openwrt.org/docs/guide-user/base-system/basic-networking</a>
for additional help on OpenWRT&#8217;s network configuration.</p>
</div>
<div class="sect2">
<h3 id="_network_interfaces">8.1. Network Interfaces</h3>
<div class="paragraph">
<p>Let&#8217;s look at the network interfaces first (cf. <code>network.ci</code>).</p>
</div>
<div class="listingblock">
<div class="title">These network interfaces are created in <code>/etc/config/network</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="uci"># Freifunk-Interface - main interface of the node
# This bridge has the configured IPv4 and IPv6 networks
# It's using the Freifunk routing table having a dual-stack configuration

# Using ip6assign und ip6class the ula space and DHCPv6 PD prefixes are used for delegation
config interface 'freifunk'
        option disabled '1'
        option ifname 'bat0'
        option type 'bridge'
        option auto '1'
        option proto 'static'
        option ipaddr '10.159.64.1'
        option netmask '255.255.255.0'
        option ip6prefix 'fdd3:5d16:b5dd:f064::/64'
        option ip6assign '64'
        list ip6class 'vpn6'
        list ip6class 'freifunk'
        list ip6class 'internet_share6'

# bat0 interface - used in the br-freifunk bridge to access batman-adv
config interface 'bat0'
        option proto 'none'
        option ifname 'bat0'


# The fastd interface is used for Freifunk Routing. Being included in babel but not in fastd,
# Other Mesh-segments are reachable using a vpn.
# For IPv4 the node's IP address is used with a /32 netmask
# For IPv6 only host routes are used
# It's disabled by default an enabled, when IP-addresses are set (i.e. using set_ip.sh)
config interface 'fastd'
    option disabled '1'
        option ifname 'tap-icvpn'
        option proto 'static'
        option ipaddr '10.159.64.1'
        option netmask '255.255.255.255'
        option ip4table '66'
        option ip6table '66'

# The VPN is used for sharing internet using a VPN tunnel. Both IPv4 and IPv6 configurations are provided
config interface 'vpn'
        option proto 'none'
        option ifname 'vpn-nat'
        option ip4table '66'
        option ip6table '66'

config interface 'vpn6'
        option proto 'dhcpv6'
        option ifname 'vpn-nat'
        option ip6table '66'

# Batman-adv meshes have ot be configured for 2.4 and 5 Ghz sperately.
# An ad-hoc wifi interface is mapped to each interface definition
# 2.4 GHz
config interface 'mesh'
        option proto 'batadv'
        option mtu '1532'
        option mesh 'bat0'

# 5 Ghz
config interface 'mesh5'
        option proto 'batadv'
        option mtu '1532'
        option mesh 'bat0'

# When used as a Freifunk/Gluon supernode, an additional fastd interfaces has to be added to babel.
# It is disabled by default
config interface 'mesh_supernode'
    option disabled '1'
    option proto 'batadv'
    option mtu '1532'
    option mesh 'bat0'
        option ifname 'tap-supernode'

# The share the internet direct, the wan interfaces has to be re-definied using a different routing table
# This copies all WAN routes to table 66
# This has to be done for IPv4 and IPv6 separately
config interface 'internet_share'
        option ifname '@wan'
        option proto 'dhcp'
        option ip4table '66'
        option disabled '1'

config interface 'internet_share6'
        option ifname '@wan'
        option ip6table '66'
        option disabled '1'
        option proto 'dhcpv6'</code></pre>
</div>
</div>
<div class="paragraph">
<p>That is it :-). Try matching these interfaces with bird&#8217;s eye perspective picture in the
beginning (Figure 1).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You might need to adjust some interfaces according to your local
setup (i.e. <code>internet_share</code> - use <code>proto 'static'</code> instead of <code>proto 'dhcp'</code>). All vpn and fastd interfaces can be removed, if vpn connections are not in use.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_routes_rules">8.2. Routes &amp; Rules</h3>
<div class="paragraph">
<p>Node-config uses a dedicated routing table (66). This allows separating the mesh
from uplink and management networks. To build this table, all relevant IPv4 and IPv6 routes
are duplicated. In addition, IP rules assign mesh traffic to this table.</p>
</div>
<div class="paragraph">
<p>Have a look at the <a href="https://www.tldp.org/HOWTO/Adv-Routing-HOWTO/">Linux Advanced Routing &amp; Traffic Control HOWTO</a>
for more information on policy based routing.</p>
</div>
<div class="listingblock">
<div class="title">Routes and Rules in <code>network.uci</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="uci"># The configured IPv4 network is reachable in the freifunk bridge
config route 'route4_node_subnet'
        option interface 'freifunk'
        option target '10.159.64.0'
        option netmask '255.255.255.0'
        option gateway '0.0.0.0'
        option table '66'

# The configured IPv6 network is reachable in the freifunk bridge
config route6 'route_6_node_subnet'
        option interface 'freifunk'
        option target 'fdd3:5d16:b5dd:f064::/64'
        option table '66'

# For both babel interfaces (2.4 GHz, 5 GHz) there's a host route for the interface address
config interface 'babel_mesh'
        option disabled '1'
        option proto 'static'
        option ipaddr '10.159.64.1'
        option netmask '255.255.255.255'
        option ip4table '66'
        option ip6table '66'

config interface 'babel_mesh5'
        option disabled '1'
        option proto 'static'
        option ipaddr '10.159.64.1'
        option netmask '255.255.255.255'
        option ip4table '66'
        option ip6table '66'

# Use table 66 for all Freifunk traffic
config rule 'rule4_freifunk_out'
           option out     'freifunk'
        option lookup '66'
        option priority '66'

config rule6 'rule6_freifunk_out'
        option out     'freifunk'
        option lookup '66'
        option priority '66'

config rule 'rule4_freifunk_in'
        option in     'freifunk'
        option lookup '66'
        option priority '66'

config rule6 'rule6_freifunk_in'
        option in     'freifunk'
        option lookup '66'
        option priority '66'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Unfortunately, OpenWRT cannot create all rules using <code>/etc/config/network</code>. Thus
they&#8217;re created using the firewall script <code>/etc/firewall.user</code>. Being part of node-config
<code>rules.sh</code> modies the the firewall script. <code>|| true</code> prevents <code>firewall.user</code> from failing, if
an interface is not available, yet.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>When adding new interfaces to babel (i.e. l2tp connections), new
rules have to be added accordingly.</p>
</li>
<li>
<p>The firewall is reload, when new interfaces become available.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Rules added by <code>firewall.user</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="uci">mv /etc/rc.local /tmp/rc.local

echo &quot;
#!/bin/sh

# Hack: https://lists.openwrt.org/pipermail/openwrt-users/2016-March/004150.html
# Since /etc/config/network cannot be used for intering rules, the firewall script is used

# Pref 66 is important. It prevents rules with priority 0 (for local)

ip rule del iif wlan0 lookup 66 pref 66 || true
ip rule del oif wlan0 lookup 66 pref 66 || true
ip rule del iif wlan1 lookup 66 pref 66 || true
ip rule del oif wlan1 lookup 66 pref 66 || true
ip rule del iif tap-icvpn lookup 66 pref 66 || true
ip rule del oif tap-icvpn lookup 66 pref 66 || true


ip rule add iif wlan0 lookup 66 pref 66
ip rule add oif wlan0 lookup 66 pref 66
ip rule add iif wlan1 lookup 66 pref 66
ip rule add oif wlan1 lookup 66 pref 66
ip rule add iif tap-icvpn lookup 66 pref 66
ip rule add oif tap-icvpn lookup 66 pref 66

ip -6 rule del iif wlan0 lookup 66 pref 66 || true
ip -6 rule del oif wlan0 lookup 66 pref 66 || true
ip -6 rule del iif wlan1 lookup 66 pref 66 || true
ip -6 rule del oif wlan1 lookup 66 pref 66 || true
ip -6 rule del iif tap-icvpn lookup 66 pref 66 || true
ip -6 rule del oif tap-icvpn lookup 66 pref 66 || true


ip -6 rule add iif wlan0 lookup 66 pref 66
ip -6 rule add oif wlan0 lookup 66 pref 66
ip -6 rule add iif tap-icvpn lookup 66 pref 66
ip -6 rule add oif tap-icvpn lookup 66 pref 66

ip -6 rule add iif wlan1 lookup 66 pref 66
ip -6 rule add oif wlan1 lookup 66 pref 66
ip -6 rule add iif tap-icvpn lookup 66 pref 66
ip -6 rule add oif tap-icvpn lookup 66 pref 66

&quot; &gt; /etc/rc.local
chmod 755 /etc/rc.local
cat /tmp/rc.local &gt;&gt; /etc/rc.local</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_pptp_configuration">8.3. PPtP configuration</h3>
<div class="paragraph">
<p><code>network_pptp.uci</code> has additional interfaces for PPtP. Due to this separation,
PPtP interfaces are not created, when using the node-config opkg-package, only.</p>
</div>
<div class="listingblock">
<div class="title">PPtP interface from <code>/etc/config/network_pptp.uci</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="uci"># VPN - if pptp is used
# Servers are
# - omni.freifunk-koeln.de
# - yagi.freifunk-koeln.de
# Accounts: please mail vpn@freifunk-koeln.de
config interface 'vpn_pptp'
        option disabled '1'
        option proto 'pptp'
        option server '195.54.164.202'
        option username 'user'
        option password 'password'
        option ip4table '66'
        option ip6table '66'

config interface 'vpn_pptp6'
        option proto 'dhcpv6'
        option ifname '@vpn_pptp'
        option ip6table '66'</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__etc_config_babeld">9. /etc/config/babeld</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://www.irif.fr/~jch/software/babel/">Babeld</a> is used for routing.
It uses the ad-hoc wifi interfaces. The optional interface tap-icvpn is included
for Freifunk routing.</p>
</div>
<div class="listingblock">
<div class="title"><code>/freifunk/initial_configuration/babeld.uci</code> defines these options:</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="uci">package babeld

# Babel uses the mesh routing table (66) for import and export
# Routes are created with a low priority (2048); thus they're not considered local.
# By that, a default route on a (Open)VPN interface has higher precedence.
config general
        option ipv6_subtrees 'true'
        option export_table '66'
        option import_table '66'
        option kernel_priority '2048'

# Export all static routes from the freifunk tables
# This is the configured IPv4 and IPv6 network of the router
config filter 'redistribute_static'
        option type 'redistribute'
        option proto '4'

# Do not export local routes (LAN-IP, address, etc.)
config filter
        option type 'redistribute'
        option local 'true'
        option action 'deny'

# Bind to both ad-hoc (802.11s) interfaces
config interface
        option ifname 'wlan0'
        option type 'wireless'

config interface
        option ifname 'wlan1'
        option type 'wireless'

# Optional fastd-interface for Freifunk Routing
config interface
        option ifname 'tap-icvpn'
        option type 'tunnel'</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__etc_config_dhcp">10. /etc/config/dhcp</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OpenWRT uses dnsmasq and odhcpd to distribute prefixes. Node-config adds new
definitions to. The OpenWRT wiki explains the DHCP options in use:
[<a href="https://openwrt.org/docs/guide-user/base-system/dhcp_configuration">1</a>,
 <a href="https://openwrt.org/docs/guide-user/base-system/dhcp">2</a>]</p>
</div>
<div class="ulist">
<div class="title">/etc/config/dhcp is used to</div>
<ul>
<li>
<p>Hand out IPv4 address configured manually (DHCP)</p>
</li>
<li>
<p>Announce the IPv6 network configured manually (radv)</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Some configuration is done in /etc/config/network</div>
<ul>
<li>
<p>Re-distributing prefixes assigned automatically to the internet uplink (DHCPv6 PD).</p>
</li>
<li>
<p>Annoucing the manually assigned /64 range for SLAAC.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">These stanzas are added by <code>dhcp.uci</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="uci">package dhcp

# A DHCP and radvd service is configured for the Freifunk interface
# The 254 address are used out the the manual prefix.

# For radvd, a default route is annouced. This enables routing freifunk traffic
# Subnet delegation is inactive. Subnets are delegated using the mesh interface, only

# Annoucing the configured /64 network is already part of /etc/network/interfaces.
# It doesn't hae to be configured, here
config dhcp 'freifunk'
        option interface 'freifunk'
        option start '2'
        option limit '254'
        option leasetime '10m'
        option dhcpv6 'none'
        option ra 'server'
        option dhcp_option '6,111.67.16.202,87.98.175.85,193.183.98.154'
        option ra_offlink '1'
        option ra_default '1'</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Using <a href="https://www.unbound.net/">unbound</a> for DNS is a good option when using
bigger router.</p>
</li>
<li>
<p>+
(outdated) <a href="https://openwrt.org/docs/guide-user/services/dns/unbound" class="bare">https://openwrt.org/docs/guide-user/services/dns/unbound</a></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__etc_config_fastd">11. /etc/config/fastd</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Fastd is a simple, decentralized vpn software. By default, fastd does neither
switching nor routing. Both is handled by batman-adv and babel.</p>
</div>
<div class="listingblock">
<div class="title">VPN definitions <code>fastd.uci</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="uci">package fastd

#fastd is used for Freifunk routing and supernode-stuff

# Test peer for Freifunk routing.
# Better: Setup your own peer and connect it to the icvpn usign BGP
config peer 'icvpn_test'
        option remote 'ipv4 &quot;5.9.31.99&quot; port 11003'
        option enabled '1'
        option net 'backbone'
        option key 'fa824f8d39adcb3ad6232660bda439020d3c2e61dd56466439fc66c0ee159b41'

# Network definition for Freifunk routing
config fastd 'backbone'
        option enabled '1'
        option syslog_level 'warn'
        option mode 'tap'
        option interface 'tap-icvpn'
        option mtu '1280'
        option forward '0'
        option secure_handshakes '1'
        list method 'salsa2012+umac'
#        list bind 'any:10000' # Bind is done using shell
        option secret 'generate'

# Template for Gluon suoernodes / disabled by default
config fastd 'supernode'
        option enabled '0'
        option syslog_level 'warn'
        option mode 'tap'
        option interface 'tap-supernode'
        option mtu '1312'
        option forward '0'
        option secure_handshakes '1'
        list method 'salsa2012+umac'
        list method 'null'
#        list bind 'any:10001' # Bind is done using shell
        option secret 'generate'</code></pre>
</div>
</div>
<div class="paragraph">
<p>fastd is bound to the lan and lan interface, only. It makes no sense to use the mesh to
tunnel mesh packages. Unfortunately, interfaces cannot be referenced by its OpenWRT name -
thus the binding is done using shell.</p>
</div>
<div class="listingblock">
<div class="title">fastd binding: <code>fastd_binding.sh</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="uci">#!/bin/sh

wan_if=$(uci get network.wan.ifname 2&gt; /dev/null) # Ignore errors =&gt; No interface anyway
lan_if=$(uci get network.lan.ifname 2&gt; /dev/null) # Ignore errors =&gt; No interface anyway

# Make sure, that fastd is using only lan and wan interfaces to avoid tunnel-in-tunnel situations
if [ $wan_if ];then
        uci add_list fastd.backbone.bind=&quot;any:10000 interface \&quot;$wan_if\&quot;&quot;
        uci add_list fastd.supernode.bind=&quot;any:10001 interface \&quot;$wan_if\&quot;&quot;
fi

if [ $lan_if ];then
        uci add_list fastd.backbone.bind=&quot;any:10000 interface \&quot;$lan_if\&quot;&quot;
        uci add_list fastd.supernode.bind=&quot;any:10001 interface \&quot;$lan_if\&quot;&quot;
fi
uci commit fastd</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__etc_config_firewall_firewall_user">12. /etc/config/firewall &amp; firewall.user</h2>
<div class="sectionbody">
<div class="paragraph">
<p>At quick glance, the firewall is used to seperate the mesh from other networks.
Firewalling is done using the OpenWRT firewall and ebtables. See
<a href="https://openwrt.org/docs/guide-user/firewall/firewall_configuration">OpenWRT &#8594; Firewall</a>
for more information on OpenWRT&#8217;s firewalling options.</p>
</div>
<div class="ulist">
<div class="title">The firewall</div>
<ul>
<li>
<p>Creates a vpn and a freifunk zone. Forwarding from freifunk to vpn is allowed.</p>
</li>
<li>
<p>Exposes the fastd vpn on the WAN interface (meshing, roaming via vpn)</p>
</li>
<li>
<p>Makes the router accessible from the freifunk zone</p>
</li>
<li>
<p>Takes care of NAT internet traffic</p>
</li>
<li>
<p>Blocks broadcast / anycast traffic to the batman-adv mesh</p>
</li>
</ul>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
Set a password on your router. It is accessible from the mesh network.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">OpenWRT firewall configuration</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="uci">package firewall

# The firewall seperates the mesh from other networkss such es wan or lan.

# Mind, that this configuration is not trusted
# your mesh router can still be compromies i.e. by exploiting babeld.
# This allows unfiltered access to your wan network.

# Allow: fastd from wan (roaming, meshing using vpn)
config rule
        option name 'fastd'
        option src 'wan'
        option dest_port '10000'
        option proto 'udp'
        option target 'ACCEPT'
        option family 'ipv4'

# Freifunk zone definition
# It has all the interfaces used for mesh routing (babel) and the central freifunk brdige.
config zone 'freifunk'
        option forward 'ACCEPT'
        option output 'ACCEPT'
        option input 'REJECT'
        option name 'freifunk'
        list network 'freifunk'
        list network 'babel_mesh'
        list network 'babel_mesh5'
        list network 'fastd'
        option mtu_fix '1'

# In the freifunk zone, the router can be access by
# 1st Babel
config rule
        option name 'Babel'
        option src 'freifunk'
        option proto 'udp'
        option dest_port '6696'
        option limit '1000/sec'
        option target 'ACCEPT'

# 2nd IGMP
config rule
        option name 'Allow IGMP (Freifunk)'
        option src 'freifunk'
        option proto 'igmp'
        option family 'ipv4'
        option target 'ACCEPT'

# 3rd ICMP
config rule
        option name 'Allow ICMP (Freifunk)'
        option src 'freifunk'
        option proto 'icmp'
        option family 'ipv4'
        option target 'ACCEPT'

# 4th DHCP
config rule
        option name 'Allow DHCP request (Freifunk)'
        option src 'freifunk'
        option dest_port '67-68'
        option proto 'udp'
        option target 'ACCEPT'
        option family 'ipv4'

# 5th ICMP v6
config rule
        option name 'Allow-ICMPv6-Input (Freifunk)'
        option src 'freifunk'
        option proto 'icmp'
        option limit '1000/sec'
        option family 'ipv6'
        option target 'ACCEPT'

# 6th SSH (Mind setting a password)
config rule
        option name 'Allow SSH (Freifunk)'
        option src 'freifunk'
        option dest_port '22'
        option proto 'tcp'
        option target 'ACCEPT'



# Internet exit through VPNs need another zone, since it has to by masquerade
config zone
        option forward 'ACCEPT'
        option output 'ACCEPT'
        option input 'REJECT'
        option name 'vpn'
        option network 'vpn vpn6 vpn_pptp vpn_pptp6'
        option masq '1'
        option mtu_fix '1'

# In the VPN zone, some incoming traffic is allowed
# 1st ICMPv6 incoming
config rule
        option name 'Allow-ICMPv6-Input (VPN)'
        option src 'vpn'
        option proto 'icmp'
        option limit '1000/sec'
        option family 'ipv6'
        option target 'ACCEPT'

# 1st ICMPv6 outgoing
config rule
        option name 'Allow-ICMPv6-Output (VPN)'
        option dest 'vpn'
        option proto 'icmp'
        option limit '1000/sec'
        option family 'ipv6'
        option target 'ACCEPT'



# This allows accessing the internet to a vpn tunnel
config forwarding 'freifunk_internet'
        option dest 'vpn'
        option src 'freifunk'

# To allow direct access, change it to:

# config forwarding 'freifunk_internet'
#        option dest 'wan'
#        option src 'freifunk'

# Mind handling abuse


# To prevent direct exit traffic accessing your uplink network,
# RFC1918 and ULA addresses are blocked.
# Please mind, that accessing public IP addresses is allowed, still.
config rule
        option name 'Do not forward freifunk traffic to RFC1918 address in WAN zone'
        option src 'freifunk'
        option dest 'wan'
        list dest_ip '10.0.0.0/8'
        list dest_ip '192.168.0.0/16'
        list dest_ip '172.16.0.0/12'
        option family 'ipv4'
        option target 'REJECT'
        option proto 'all'

config rule
        option name 'Do not forward freifunk traffic to local ipv6-addresses in WAN zone'
        option src 'freifunk'
        option dest 'wan'
        list dest_ip 'fc00::/7'
        list dest_ip 'fec0::/10'
        option family 'ipv6'
        option target 'REJECT'
        option proto 'all'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Broadcast / anycast traffic is blocked using ebtables. ebtables rules are not
exposed via uci. <code>firewall.sh</code> takes care of adding this rules to the <code>firewall.user</code> script.</p>
</div>
<div class="listingblock">
<div class="title">Contents of firewall.sh</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="uci">#!/bin/sh

# ebtables Multicast-filter - not exposed to uci
# reject multicast / broadcast within the batman-adv mesh
# allow DHCP and ARP - it is translated into unicast
echo &quot;
ebtables -F
ebtables -A FORWARD -p ARP -j ACCEPT
ebtables -A FORWARD -p IPv4 --ip-protocol udp --ip-destination-port 67:68 -j ACCEPT
ebtables -A FORWARD -d Multicast -j DROP


#&quot; &gt; /etc/firewall.user</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>For policy routing, additional ip-rules are added to <code>firwall.sh</code>. See <a href="#_routes_rules">Routes &amp; Rules</a> for details.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="__etc_config_openvpn">13. /etc/config/openvpn</h2>
<div class="sectionbody">
<div class="paragraph">
<p>OpenVPN is used to tunnel internet traffic.
Using external configuration files, the different providers are referenced, only.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="uci">package openvpn

# OpenVPN-configuration for tunnel providers
# Beispiel fuer mullvad - hier enabled (vgl. https://mullvad.net/en/)
config openvpn 'mullvad'
        option enabled '0'
        option config '/lib/freifunk/vpn/mullvad/mullvad.conf'


# Freifunk-KBU Exit-VPN
# More information:
# - https://kbu.freifunk.net/wiki/vpn-exit
config openvpn 'freifunk_kbu'
        option enabled '0'
        option config '/lib/freifunk/vpn/freifunk_kbu/client.conf'


# yanosz' Freifunk-Exit-VPN
# Used for testing
# Please freifunk@yanosz.net for access.
config openvpn 'yanosz'
        option enabled '0'
        option config '/lib/freifunk/vpn/yanosz/client.conf'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is an example for an external configuration. It can be used as a template
for other providers. Refer to
<a href="https://openvpn.net/index.php/open-source/documentation.html" class="bare">https://openvpn.net/index.php/open-source/documentation.html</a> [the OpenVPn website]
for information on different OpenVPN options.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="openvpn"># yanosz Freifunk-Exit-VPN
# used for testing
# Plase mail  freifunk@yanosz.net for access

# Path - adjust if needed
cert freifunk@yanosz.net.crt
key freifunk@yanosz.net.key

# OpenVPN must not configure routing - it cannot use a different routing table such as 66
# Routes are set using a custom scrip
route-nopull
up /lib/freifunk/vpn/up.sh

remote freifunk-vpn.yanosz.net 1194
proto udp

# As an alternative
#remote freifunk-vpn.yanosz.net 443
#proto tcp


# OpenVPN-specifics
client                  # Its a client
dev vpn-nat
dev-type tun            # Keep aligned with /etc/config/network
cipher AES-256-CBC      # 256-Bit AES encryption is used
resolv-retry infinite   # Try to establish a connection continuously
nobind
persist-key
persist-tun
comp-lzo
remote-cert-tls server
ping-restart 60         # 60 Sekunden Ping Restart Timer
script-security 2       # Scripts - needed to execute up.sh
ca ca.crt
ping 10
link-mtu 1350                        # Small MTU (tunneling through adsl lines has some offset)</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="olist arabic">
<div class="title">When setting up a new vpn provider, some settings need to be added to the provider&#8217;s configuration:</div>
<ol class="arabic">
<li>
<p><code>route no-pull</code> prevents OpenVPN from installing routes in the default routing table</p>
</li>
<li>
<p><code>up /lib/freifunk/vpn/up.sh</code> makes OpenVPN installing a default route in the
freifunk table (66), when the interface is going up.</p>
</li>
<li>
<p><code>script-security 2</code> allows OpenVPN to execute scripts such as <code>up.sh</code></p>
</li>
<li>
<p><code>dev vpn-nat</code> uses the correspondig interface defined in <code>/etc/config/network</code></p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<h1 id="_advanced_topics" class="sect0">Advanced Topics</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>You made a long way. The documentation has many complex details and its quite easy to get lost.
Anyway, you made it :-).</p>
</div>
<div class="paragraph">
<p>This chapter focuses on advanced topics. It explains how to use node-config to build packages,
create a firmware and to do configuration management.</p>
</div>
<div class="paragraph">
<p>Illustrating underlaying concepts such as multihomming, roaming an Freifunk routing is also part of this
chapter.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_building_node_config">14. Building node-config</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Node-config uses different Makefiles to generate packages and documentation.</p>
</div>
<div class="paragraph">
<p>Also, this chapter describes the underlaying network architecture and propose working methods for node-config.</p>
</div>
<div class="sect2">
<h3 id="_makefiles">14.1. Makefiles</h3>

</div>
<div class="sect2">
<h3 id="__travis_ci_yml">14.2. .travis-ci.yml</h3>

</div>
<div class="sect2">
<h3 id="_install_sh">14.3. install.sh</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_creating_firmware_configuration_management">15. Creating Firmware &amp; Configuration Management</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_underlaying_concepts">16. Underlaying concepts</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_roaming">16.1. Roaming</h3>
<div class="paragraph">
<p>Roaming concerns clients moving from one accesspoint to another. To keep all connections alive, traffic must
be redirected.</p>
</div>
<div class="paragraph">
<p>Roaming from A to B, the wifi association is updated: In the beginning, all data is transmitted to Node A.
When changing the association, data goes via Node B instead. This is illustrated in Figure 2. Due to Node A
and Node B using the same ESSID, the client interfaces is not reset.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="babel-roam.png" alt="babel roam" width="60%">
</div>
<div class="title">Figure 2. Roaming</div>
</div>
<div class="paragraph">
<p>In this scenario, packets need to be handled by a different nodes: While node A handle&#8217;s the clients packets in
the beginning, node B is responsible in the end. This is, where things get messy: Network state needs to
be updated. IP-packets need to find a new way. However, some ideas exists:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><em>Creating a large, ethernet segment using batman-adv</em>: As done in classical ethernet networks, a
client&#8217;s location is updated using <em>broadcast / multicast</em> continuously behind the scenes.
In this a flat, MAC-based address scheme, routes cannot be aggregated. In Freifunk communities, these networks
are VPN based and scale up to 1000 ~ 2000 nodes.</p>
</li>
<li>
<p><em>Update IP routing on roaming:</em> Instead of creating a large ethernet segment, the network is split into
one segment per node. One dedicated subnet is assigned per segment. IP-Packets are routed between those segments
using traditional IP-routing. Whenever a client roams, a host route is added to the routing table. This
approach reduces the size of the routing table. But in order to so, each node needs to know all IP-addresses
used by clients roaming into its segment. Getting only a mac address from the wifi association, this task is very
challenging. <a href="https://github.com/freifunk-gluon/l3roamd/network">l3roamd</a> tries to go this way, but it is not
ready for production, yet.</p>
</li>
<li>
<p><em>Mobile-IP like approaches.</em> In <a href="https://en.wikipedia.org/wiki/Mobile_IP">Mobile IP</a>
traffic is handled by a home node and passed along the network. It takes care of maintaining reachability
information and passing packets to its clients. As a downside, routing through a home node may increases the
forwarding path. In addition, management traffic for both batman-adv and babel has to be handled.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Combining babel and batman-adv, node-config includes configuration for a mobile IP like system, while not
being restricted to it. Its functionality is illustrated in the next sections:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In an Mobile IP like setup, the forwarding path doesn&#8217;t increase necessarily.
In order to prevent source ip spoofing and to maintain NAT state in a multi homed network, external
traffic is routed via fixed "home-ish" gateway node in any situation.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_roaming_in_node_config_using_ipv4">16.1.1. Roaming in node-config using IPv4</h4>
<div class="paragraph">
<p>Figure 2 illustrates roaming IPv4.  A client roams from Node A to Node B.
The traffic-flow is green, while network connections are red.</p>
</div>
<div class="paragraph">
<p>The batman-adv mesh cloud connects all segments <em>in transmission range</em>. It acts as a huge network switch.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="babel-ipv4-roam.png" alt="babel ipv4 roam" width="60%">
</div>
<div class="title">Figure 3. IPv4 Roaming</div>
</div>
<div class="paragraph">
<p>The client is using 10.0.1.42 from Node A&#8217;s dhcp range. By that, <em>node A is the home node</em> of the client.
When roaming, node A is responsible for handling all the traffic. As in classical ethernet,
Node A reaches the client by its MAC-address.</p>
</div>
<div class="paragraph">
<p>Keep in mind, that ethernet segments are <em>limited by the transmission range</em> of the nodes.
There is no large ethernet segments connecting all nodes using a VPN.</p>
</div>
</div>
<div class="sect3">
<h4 id="_roaming_in_node_config_using_ipv6">16.1.2. Roaming in node-config using IPv6</h4>
<div class="paragraph">
<p>For IPv6 the situation is more complex. In contrast to IPv4, clients have multiple annouced
using radvd routes.</p>
</div>
<div class="paragraph">
<p>In node-config, a different default route is annouced by every router. When a clients roams to a
different node, it has two default routes, at least. This is illustrated in figure 4.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="babel-ipv6-roam.png" alt="babel ipv6 roam" width="60%">
</div>
<div class="title">Figure 4. IPv6 Roaming</div>
</div>
<div class="paragraph">
<p>As before, the clients roams from node A to node B. Before connecting to node B it is reachable at
fd00:1::42. This address is allocated using slaac in node A&#8217;s segment.</p>
</div>
<div class="paragraph">
<p>When moving two node B, the client gets another default and an additional address (not shown) from the
 radvd running on node B. Having two default routes, the client can access the network via node A (route #1) and node B (route #2).</p>
</div>
<div class="paragraph">
<p>Thus traffic is slightly asymmetric.</p>
</div>
<div class="ulist">
<div class="title">From the clients point of view:</div>
<ul>
<li>
<p>Incoming traffic arrives via Node A, only. To reach the client, it is send trough the batman-adv cloud</p>
</li>
<li>
<p>Outgoing traffic is asymmetric:</p>
<div class="ulist">
<ul>
<li>
<p>If the client chooses the old route, traffic is reaching node A through the batman-adv cloud</p>
</li>
<li>
<p>If the client chooses the new route, traffic <em>may</em> by routed via node A using babel. External traffic
always leaves the mesh via node A due to source specific routing. Assuming, that most traffic is directed to
the internet, node A is used in most of the cases.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ipv6_multihoming_prefix_delegation">16.2. IPv6 Multihoming &amp; Prefix delegation</h3>

</div>
<div class="sect2">
<h3 id="_icvpn_routing">16.3. ICVPN routing</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_design_considerations">17. Design considerations</h2>
<div class="sectionbody">

</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2018-05-18 19:19:23 CEST
</div>
</div>
</body>
</html>